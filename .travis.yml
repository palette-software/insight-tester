language: go

go:
    - 1.5

env:
    matrix:
        - GIMME_OS=darwin GIMME_ARCH=386
        - GIMME_OS=darwin GIMME_ARCH=amd64
        - GIMME_OS=linux GIMME_ARCH=386
        - GIMME_OS=linux GIMME_ARCH=amd64
        - GIMME_OS=windows GIMME_ARCH=386
        - GIMME_OS=windows GIMME_ARCH=amd64
    global:
        - secure: "FqOqp2bWrcQ2vTVqHAj5RhvMra7sxWU4TEoTq2CWz0s20+vL/B36fOPL69kIZ9sHfcxlW76HH2hdhsHokC82rnXOLfsM6m00A8nYqhOQleuS1lGTwMqXhC019+sX7RiuX4OghvZ4Jh3QMJ3nZLBJGy6YQ0F3LH6AZVbjHoBLUpvTeNuvVI06JRqm1oUssNwjeL5r6tV0OREIslXl6Ess/RR1Zx0+aJ+Hn6XrOCO+cqs0uHCWNKlmyFl9VTjMB2WwIWsNH6YCPHtBFSfUsbyj1tDnwLXlraSLCY4kA6y/atW693Lrg18CvnaTw2sEbCKVE3K/tFd2S4CXQ1hSymQSkYGiBjrylfOCH5o//lfZptEmwjCht7e30cqcOvbUmYUEcQ29BJEWvEj0OXebFPmfxxRllBdWQppRvRiaOQJgUIKiRsQhia9NzEhXecgXp5HKqJf5CYaxatRD6WAixUj5DcIfSsxpFgJgI3DqkuQdiK4e4frWJSPNMKyFwGgrcRoMoLAdqopgx1zr2ehVhw1VxOcTZYVauJClU0chBnKnK7+TVbRk7/VknegV1+rFAFtP1GgChB2Fjs+zTjibWO5qkkU+QNj6NlPsu4V71xOnx3XbcTq9RUKY4/ymqL9W81GHKZ7smI+q47/qDrihlX1dmfqGYnMn77YcAIuWvNQ4KWo="

# workaround for travis-ci/gimme#25 to pick up latest version of gimme and run again
before_install:
  - echo -e "machine github.com\n  login $GITHUB_TOKEN" >> ~/.netrc
  - curl -o gimme -sL https://raw.githubusercontent.com/travis-ci/gimme/master/gimme
  - chmod u+x gimme
  - unset GOROOT GOTOOLDIR GIMME_NO_ENV_ALIAS
  - eval "$(./gimme 1.5)"
  - go version
  - go env

script:
    - go install -v ./...
    - chmod ugo+x travis_run_go_test.sh
    - ./travis_run_go_test.sh

after_success:
    - cd $GOPATH/bin/
    - export CURRENT_ENV_DIR=${GIMME_OS}_${GIMME_ARCH}
    - export PCKG_FILE=${CURRENT_ENV_DIR}.zip
    - mkdir -p $CURRENT_ENV_DIR
    - cp -f $GOPATH/bin/* $CURRENT_ENV_DIR/
    - zip -r $PCKG_FILE $CURRENT_ENV_DIR

deploy:
  provider: releases
  user: palette-robot
  password:
    secure: FQDnvXWgkzRFcd/64uEVuX6uoq66b8ADbejju+IEpJGV1Imo/TX08Hkl/G11IKzaOhpGCr1Ypfaf28mlzZHRnoOUTkKq9Dv79rH6d26h2R1dZnSSffPbvPVoEqDCWTAPRQwMHCPMcOdl292AM1WkrfNaJDo1G6UpoMnunDXg/5uQGCVBiZqGRSNIrjz/VQxaSHZn/HGhk+3jU97g0Iriu6GSddIC/iyeMUGcAQjoPCFbRspYBWgbozilzKr5BLsHkMwfNZ7B5G8scnjlD6gpC+b3Wq2o7Yg7KRzYkVEOAQM9DC/Yrv60HyPyPnuAWWcaNX44FzE/lwO8onlR4Z+lcneYzRrWQ9d2n26GBvAG13BIbysohf7X+fKmpXLxxW8rDG+PqRhYifWd46926DNxYQduktSzgIReKnkyHjn9uUMmiEQaFQFSVYil2UgjF5S8zM1XAJPBBlcZET4z0l1RK0OXrm3PRqY2VTJ328eOCZTHJcX5qI02a/Mbe5MLxQBjT06bVltntldQLvDbo94w9LCfRJTN1uAdQMgAyiQ7dDB/S3W0/1/5ufvX6KZn4IfY1cfSLx/gsUTSv0J1u3juyE5rtDQicFqwABBJhmMtSF1fYqxj3feuN/2UIUi8ivWBSWHrm2W9M0lgXvfj6FmiGr97Jar9lq52cb0hD0GLM6c=
  file:
  - ${GOPATH}/bin/${GIMME_OS}_${GIMME_ARCH}.zip
  skip_cleanup: true
  on:
    tags: true
notifications:
  email: false
